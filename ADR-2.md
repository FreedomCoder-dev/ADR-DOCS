# ADR - **Выбор языка программирования для серверной части**

**Участники:**
- Мухин
- Мухорин
- Пряшников

**Дата:** 28 сент. 2024 г.

**Статус:** Решено

## Контекст

- Команда: 3 балбеса
  - все трое сдали ООП малову на 5
  - один балбес знает все языки программирования и иммет опыт работы со всеми архитектурами
- Бюджет: 3 хотдога в неделю 
- Ресурсы: доступен проектный сервер (уже оплачен на 10 лет), два старых ноутбука, один модный MacBook Pro M1 Max 14" 64G 1Tb
- Сроки: на реализацию MVP имеется 6 месяцев
- Целевая аудитория: компании, отказывающиеся от зарубежных решений по редактированию документов.
- [Серверное решение](ADR-1.md) с возможностью переезда в Serverless в будущем

Надо разработать систему онлайн документов с возможностью совместного доступа и редактирования - реалтайм, расчётная нагрузка до 2000 RPM и 1000 keepalive sessions, приоритет на сокращении длины пакетов, так как канал [выбранного нами сервера](ADR-1.md) составляет всего 100Мбит (фактически 50-70Mbit при средней загрузке сети регионального оператора). Фото доступного при нашем текущем бюджете серверного оборудования ниже:


![Серверное оборудование](Pasted20240928101811.png)

## Рассматриваемые варианты

- ASM
    - Свело олдскулы
    - Безумно модный
    - Максимально быстрый из-за прямого доступа к исполняемым инструкциям (при прямых руках (такие имеются))
    - Простой, минималистичный синтаксис
    - Вечно актуален - поддержка, которая никогда не закончится
    - Легко настроить пайплайн сборки
    - Безграничные возможности по манипуляции инструкциями в рантайме
    - Возможно подключать любые native precompiled решения
    - Поддержка всех архитектур АЛУ и hardware-модулей ЭВМ
    - Эффективное использование ресурсов благодаря полному контролю над ними
    - Наименьший memory footprint, executable size и response latency
    - Отсутствие GC и самая эффективная модель управления динамической памятью гарантирует наименьшую дисперсию времени ответа
    - Отсуствует стандартная библиотека (но можно подключить любую от другого языка)
- C
    - Очень старомодный
    - Продуцирует менее оптимальний бит-код, чем ASM 
    - Высокая производительность благодаря низкоуровневому доступу к памяти и эффективной компиляции (при прямых руках (такие имеются))
    - Простой синтаксис
    - Вечно актуален из-за огромного легаси - поддержка, которая никогда не закончится
    - Достаточно легко настроить пайплайн сборки
    - Возможность подключения библиотек на C и других языках через FFI. Но их интеграция вызывает боль 
    - Делит второе место (среди представленных вариантов) по производительности с Rust
    - Эффективная модель динамической памяти - полный контроль над ресурсами
    - Поддержка большинства архитектур и платформ, включая embedded-системы
- C++
	- Очень старомодный
	- Быстро работает при прямых руках (такие имеются)
	- Перегруженный синтаксис - увеличивает время разработки и сложность проектирования
	- Слишком устарел для современных реалий
    - Вечно актуален из-за огромного легаси - поддержка, которая никогда не закончится
	- Есть много библиотек, но их интеграция зачастую вызывает кровоизлияние в мозг (на Windows ещё может спровоцировать инфаркт)
- Golang
	- Модный
	- Язык от корпорации добра - поддержка и ими, и комьюнити
	- GC позволяет расслабляться при разработке
	- Разработан с серверными решениями in mind
	- Небольшой memory footprint
- Swift
    - Extremely модный
    - Самый современный синтаксис
    - Модель памяти позволяет расслабляться при разработке при соблюдении простых правил
	- Мало библиотек для серверной разработки
    - Пайплайны CD могут быть сложными или нестабильными из-за короткого времени поддержки ОС не на основе Darwin
- JavaScript (TypeScript)
	- Модный
	- Не очень медленно работает при прямых руках (такие имеются)
	- Большой memory footprint
	- Экосистема поражает воображение размерами
    - Легко настроить пайплайны CD
    
- Rust
    - Extremely модный
    - Активно развивается и поддерживается сообществом
    - Делит 2 место по производительности с С
    - Современный и выразительный синтаксис
    - Удобные инструменты для сборки
    - Развитая экосистема
    - Возможность интеграции с нативным кодом через FFI
    - Поддержка множества платформ и архитектур
    - Эффективное использование ресурсов благодаря строгой системе типов и проверке заимствований
    - Легко настроить пайплайны CD
- Kotlin
	- Модненький
    - Активно развивается и поддерживается корпоратами (даже для серверов)
	- GC от JVM хорош - можно расслябляться
	- Есть JIT - скорость может достигать показателей C
	- Байткод толстый - может проседать производительность
	- Серверные фреймворки сыроваты - внезапные баги вероятны 
	- JVM безопасен и почти никогда не может жестко упасть при должных механизмах autorecovery
	- Требует установки толстого JRE
	- Обещают допилить GraalVM или Kotlin Native - на момент написания всё плохо, но если допилят - можно будет летать на нативе 
    - Легко настроить пайплайны CD
    
- C#
    - Немодный
    - Позорный язык от жадной корпорации по единогласному мнению команды
    - Медленный
    
- Python
    - Модный
    - Бывает медленным даже при прямых руках (такие имеются)
    - Экосистема поражает воображение размерами
    - Легко настроить пайплайны CD

## Решение

**Golang**

## Обоснование

Выбор Golang обусловлен следующими факторами:

1. **Модность:** Модный язык, на нём пишет много программистов.
2. **Компетенции и сроки:** Наша команда в целом имеет больше людей, которые знакомы с языком, что позволит параллелить работу и уложиться в сроки.
3. **Одобрение архитектора:** Архитектор одобряет
3. **Производительность:** Производительность оптимизирована под серверные решения, что идеально для нас
3. **Многопоточка:** Многопоточность отлично реализована в языке - позволит быстро кодить эффективные решения
5. **Разработка командой балбесов:** Модель памяти позволяет расслабляться при разработке - идеально для команды балбесов.
6. **Поддержка:** Поддерживается корпорацией добра и сообществом, должен прожить ещё пару дюжин лет.
7. **Рентабельность:** Является наиболее рентабельным языком с точки зрения скорости работы относительно вложений времени

## Последствия

**Зависимость от корпорации добра:** Google может манипулировать мелкими разработчиками через ломание API.
  - **Реакция:** молча адаптируемся.

**Архитектурные решения навязываются языком** Язык навязывает определённый стиль разработки 
  - **Реакция:** Смириться и не роптать.
### Риски
1. **Отказ от поддержки корпоратами**
   - **Реакция:** с болью в сердце переписывать на более модный язык

## Затронутые области

1. **Инфраструктура:** Необходимость настройки CI/CD и окружений для развёртывания определённым образом.
2. **Проектирование:** Необходимость принимать архитектурные решения с учётом особенностей языка.

## История

----
